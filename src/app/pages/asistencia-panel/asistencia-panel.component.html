<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>Panel de Asistencia</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon slot="icon-only" name="log-out-outline" color="danger"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="asistencia-content">

  <!-- Profile Card -->
  <div class="profile-section">
    <ion-card class="profile-card">
      <div class="profile-header">
        <div class="avatar-container">
          <ion-icon name="person-circle" class="avatar-icon"></ion-icon>
          <div class="status-indicator" [class.active]="!yaRegistroSalida"></div>
        </div>
        <div class="profile-info">
          <h2 class="profile-name">{{ currentUser?.nombre }} {{ currentUser?.apellido }}</h2>
          <p class="profile-role">
            <ion-icon name="briefcase-outline"></ion-icon>
            {{ currentUser?.rol === 'admin' ? 'Administrador' : 'Empleado' }}
          </p>
        </div>
      </div>

      <div class="profile-details">
        <div class="detail-item">
          <ion-icon name="card-outline"></ion-icon>
          <span>DNI: {{ currentUser?.dni }}</span>
        </div>
        <div class="detail-item">
          <ion-icon name="calendar-outline"></ion-icon>
          <span>{{ currentDate | date: 'fullDate' }}</span>
        </div>
      </div>
    </ion-card>
  </div>

  <!-- Quick Stats -->
  <div class="stats-section">
    <div class="stat-card">
      <ion-icon name="time-outline" class="stat-icon primary"></ion-icon>
      <div class="stat-info">
        <p class="stat-value">{{ horaEntrada }}</p>
        <p class="stat-label">Entrada</p>
      </div>
    </div>
    <div class="stat-card">
      <ion-icon name="exit-outline" class="stat-icon success"></ion-icon>
      <div class="stat-info">
        <p class="stat-value">{{ horaSalida }}</p>
        <p class="stat-label">Salida</p>
      </div>
    </div>
    <div class="stat-card">
      <ion-icon name="checkmark-circle-outline" class="stat-icon secondary"></ion-icon>
      <div class="stat-info">
        <p class="stat-value">{{ totalAsistenciasMes }}</p>
        <p class="stat-label">Este mes</p>
      </div>
    </div>
  </div>

  <!-- Horario del Usuario -->
  <div class="section-header">
    <h3 class="section-title">
      <ion-icon name="time-outline"></ion-icon>
      Tu Horario de Trabajo
    </h3>
  </div>

  <ion-card class="horario-card">
    <ion-card-content>
      <div class="horario-info">
        <div class="horario-item">
          <ion-icon name="log-in-outline" color="primary"></ion-icon>
          <div>
            <p class="horario-label">Entrada</p>
            <p class="horario-value">{{ currentUser?.hora_entrada }}</p>
          </div>
        </div>
        <div class="divider-vertical"></div>
        <div class="horario-item">
          <ion-icon name="log-out-outline" color="success"></ion-icon>
          <div>
            <p class="horario-label">Salida</p>
            <p class="horario-value">{{ currentUser?.hora_salida }}</p>
          </div>
        </div>
      </div>
      <p class="horario-note">
        <ion-icon name="information-circle-outline"></ion-icon>
        Tolerancia de ±15 minutos
      </p>
    </ion-card-content>
  </ion-card>

  <!-- Botones de Registro -->
  <div class="section-header">
    <h3 class="section-title">
      <ion-icon name="checkmark-done-outline"></ion-icon>
      Registrar Asistencia
    </h3>
  </div>

  <div class="registro-buttons">
    <!-- Botón Registrar Entrada -->
    <ion-card
      class="registro-card entrada-card"
      button
      (click)="registrarEntrada()"
      [disabled]="yaRegistroEntrada">
      <div class="registro-icon">
        <ion-icon name="log-in-outline"></ion-icon>
      </div>
      <div class="registro-content">
        <h4>Registrar Entrada</h4>
        <p>Marca tu llegada al trabajo</p>
        <ion-badge
          [color]="yaRegistroEntrada ? 'success' : 'primary'"
          class="registro-badge">
          {{ yaRegistroEntrada ? 'Registrado ✓' : 'Pendiente' }}
        </ion-badge>
      </div>
    </ion-card>

    <!-- Botón Registrar Salida -->
    <ion-card
      class="registro-card salida-card"
      button
      (click)="registrarSalida()"
      [disabled]="!yaRegistroEntrada || yaRegistroSalida">
      <div class="registro-icon">
        <ion-icon name="log-out-outline"></ion-icon>
      </div>
      <div class="registro-content">
        <h4>Registrar Salida</h4>
        <p>Marca tu salida del trabajo</p>
        <ion-badge
          [color]="yaRegistroSalida ? 'success' : (!yaRegistroEntrada ? 'medium' : 'warning')"
          class="registro-badge">
          {{ yaRegistroSalida ? 'Registrado ✓' : (!yaRegistroEntrada ? 'Bloqueado' : 'Pendiente') }}
        </ion-badge>
      </div>
    </ion-card>
  </div>

  <!-- Quick Actions -->
  <div class="section-header">
    <h3 class="section-title">
      <ion-icon name="flash-outline"></ion-icon>
      Acciones Rápidas
    </h3>
  </div>

  <div class="actions-grid">
    <ion-card class="action-card" button routerLink="/historial">
      <ion-icon name="list-outline" color="primary"></ion-icon>
      <p>Historial</p>
    </ion-card>
    <ion-card class="action-card" button>
      <ion-icon name="stats-chart-outline" color="success"></ion-icon>
      <p>Reportes</p>
    </ion-card>
    <ion-card class="action-card" button>
      <ion-icon name="settings-outline" color="medium"></ion-icon>
      <p>Perfil</p>
    </ion-card>
    <ion-card class="action-card" button>
      <ion-icon name="help-circle-outline" color="warning"></ion-icon>
      <p>Ayuda</p>
    </ion-card>
  </div>

</ion-content>
